{% extends "portal/base.html" %}
{% block content %}
<h4 class="mb-3">Pedido #{{ object.id }}</h4>
<div class="bg-white rounded shadow-sm p-3 mb-3">
  <div><strong>Cliente:</strong> {{ object.cliente }}</div>
  <div><strong>Status:</strong> {{ object.get_status_display }}</div>
  <div><strong>Observações:</strong> {{ object.observacoes|linebreaksbr }}</div>

<div class="bg-white rounded shadow-sm p-3 mb-3">
  <form method="post" action="{% url 'sales:order_payment' object.id %}" class="row g-2 align-items-end">
    {% csrf_token %}
    <div class="col-auto">
      <label class="form-label mb-0">Forma de pagamento</label>
      <select name="meio_pagamento" class="form-select">
        <option value="Pix">Pix</option>
        <option value="Dinheiro">Dinheiro</option>
        <option value="Cartão de Débito">Cartão de Débito</option>
        <option value="Cartão de Crédito">Cartão de Crédito</option>
        <option value="Boleto">Boleto</option>
        <option value="Transferência">Transferência</option>
        <option value="Outro">Outro</option>
      </select>
    </div>
    <div class="col-auto">
      <button class="btn btn-primary">Salvar &amp; gerar CR</button>
    </div>
    <div class="col-auto ms-auto">
      <a class="btn btn-outline-secondary" href="{% url 'finance:cr_list' %}">Ver Contas a Receber</a>
    </div>
  </form>
</div>

</div>
<div class="bg-white rounded shadow-sm p-3">
  <table class="table table-sm">
    <thead><tr><th>Produto</th><th>Descrição</th><th>Qtd</th><th>Preço</th><th>Subtotal</th></tr></thead>
    <tbody>
      {% for i in object.itens.all %}
      <tr>
        <td>{{ i.produto|default:'—' }}</td>
        <td>{{ i.descricao }}</td>
        <td>{{ i.quantidade }}</td>
        <td>R$ {{ i.preco_unitario }}</td>
        <td>R$ {{ i.subtotal }}</td>
      </tr>
      {% empty %}
      <tr><td colspan="5" class="text-center text-muted">Sem itens</td></tr>
      {% endfor %}
      <tr><td colspan="4" class="text-end"><strong>Total bruto:</strong></td><td><strong>R$ {{ object.total_bruto }}</strong></td></tr>
      <tr><td colspan="4" class="text-end"><strong>Desconto:</strong></td><td><strong>R$ {{ object.desconto_total }}</strong></td></tr>
      <tr><td colspan="4" class="text-end"><strong>Total líquido:</strong></td><td><strong>R$ {{ object.total_liquido }}</strong></td></tr>
    </tbody>
  </table>
</div>
{% endblock %}
